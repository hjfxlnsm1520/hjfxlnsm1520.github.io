<script>
  const instructions = [
    { text: "請按按鈕", type: "click" },
    { text: "不要按按鈕（等 2 秒）", type: "wait" },
    { text: "三秒後再按", type: "delay" }
  ];

  let score = 0;
  let current;
  let canClick = false;
  let roundActive = true;
  let waitTimer;

  function newRound() {
    roundActive = true;
    canClick = false;
    clearTimeout(waitTimer);

    current = instructions[Math.floor(Math.random() * instructions.length)];
    document.getElementById("instruction").textContent = current.text;

    if (current.type === "click") {
      canClick = true;
    }

    if (current.type === "delay") {
      setTimeout(() => {
        canClick = true;
      }, 3000);
    }

    if (current.type === "wait") {
      waitTimer = setTimeout(() => {
        if (roundActive) {
          score++;
          updateScore();
          newRound();
        }
      }, 2000);
    }
  }

  function playerClick() {
    if (!roundActive) return;

    if (
      (current.type === "click" && canClick) ||
      (current.type === "delay" && canClick)
    ) {
      score++;
    } else {
      score--;
    }

    roundActive = false;
    updateScore();
    newRound();
  }

  function updateScore() {
    document.getElementById("score").textContent = "分數：" + score;
  }

  newRound();
</script>
